<!DOCTYPE html>
<html>

  <head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-39729658-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-39729658-3');
</script>


  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Hunting for Cell Towers</title>
  <meta name="description" content="Hello! I have created an Android app that logs cell phone signal data. I used the app as part of a personal project to locate cell phone towers in the town t...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://szonov.com/programming/2019/10/30/hunting-for-cell-towers/">
  <link rel="alternate" type="application/rss+xml" title="Stan Zonov" href="https://szonov.com/feed.xml" />
</head>


  <body>
	
    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Stan Zonov</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
	<a class="page-link" href=""></a>
        
		
			<a class="page-link" href="/about/">About</a>
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			<a class="page-link" href="/photos/">Photos</a>
		
        
          <a class="page-link" href="/programming/2019/10/30/hunting-for-cell-towers/">Blog</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
 	 
    <h1 class="post-title">Hunting for Cell Towers</h1>
    <p class="post-meta">Oct 30, 2019</p>
  </header>

  <article class="post-content">
    <p>Hello! I have created an Android app that logs cell phone signal data. I used the app as part of a personal project to locate cell phone towers in the town that I am living in.</p>

<p>I came across <a href="https://math.stackexchange.com/questions/623977/applying-a-kalman-filter-to-a-wifi-power-signal?rq=1">this post</a> discussing utilizing the Kalman filter for locating an device near Wifi signal. After briefly seeing if something similair can be done where I’m living I determined it wasn’t given the space and tools present. Full of hope, I wanted to check if it possible to do something similar for cell signals. This provided the perfect excuse to create my very first android application that can be used to log the cell signal strength at your location along with the GPS location. Here are the two relevant app files:</p>

<p><code class="language-plaintext highlighter-rouge">AndroidManifest.xml</code></p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">package=</span><span class="s">"com.example.celltower"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.ACCESS_COARSE_LOCATION"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.READ_PHONE_STATE"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.READ_SMS"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.ACCESS_FINE_LOCATION"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.WRITE_EXTERNAL_STORAGE"</span><span class="nt">/&gt;</span>examp
    <span class="nt">&lt;application</span>
        <span class="na">android:allowBackup=</span><span class="s">"true"</span>
        <span class="na">android:icon=</span><span class="s">"@mipmap/ic_launcher"</span>
        <span class="na">android:label=</span><span class="s">"@string/app_name"</span>
        <span class="na">android:roundIcon=</span><span class="s">"@mipmap/ic_launcher_round"</span>
        <span class="na">android:supportsRtl=</span><span class="s">"true"</span>
        <span class="na">android:theme=</span><span class="s">"@style/AppTheme"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">".MainActivity"</span>
            <span class="na">android:launchMode=</span><span class="s">"singleTop"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.MAIN"</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.LAUNCHER"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>
    <span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">MainActivity.java</code></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.celltower</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.os.AsyncTask</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.Manifest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.pm.PackageManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Handler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">androidx.appcompat.app.AppCompatActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">androidx.core.app.ActivityCompat</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.location.Location</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.location.LocationListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.location.LocationManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.location.Criteria</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">android</span><span class="o">.</span><span class="na">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_COARSE_LOCATION</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">android</span><span class="o">.</span><span class="na">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_FINE_LOCATION</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">android</span><span class="o">.</span><span class="na">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_PHONE_STATE</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">android</span><span class="o">.</span><span class="na">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_SMS</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">android</span><span class="o">.</span><span class="na">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">WRITE_EXTERNAL_STORAGE</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.FileNotFoundException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.os.Environment</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStreamWriter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.telephony.TelephonyManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="nc">AppCompatActivity</span> <span class="kd">implements</span> <span class="nc">LocationListener</span> <span class="o">{</span>

    <span class="nc">TextView</span> <span class="n">textView</span><span class="o">;</span>
    <span class="nc">Context</span> <span class="n">context</span><span class="o">;</span>
    <span class="nc">Location</span> <span class="n">location</span><span class="o">;</span>
    <span class="nc">LocationManager</span> <span class="n">locationManager</span><span class="o">;</span>
    <span class="kt">boolean</span> <span class="nc">GpsStatus</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="nc">String</span> <span class="nc">Holder</span><span class="o">;</span>
    <span class="nc">Criteria</span> <span class="n">criteria</span><span class="o">;</span>


    <span class="nc">Handler</span> <span class="n">handler</span><span class="o">;</span>
    <span class="nc">Runnable</span> <span class="n">test</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLocationChanged</span><span class="o">(</span><span class="nc">Location</span> <span class="n">location</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// textViewLongitude.setText("Longitude:" + location.getLongitude());</span>
        <span class="c1">//textViewLatitude.setText("Latitude:" + location.getLatitude());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStatusChanged</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="nc">Bundle</span> <span class="n">bundle</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProviderEnabled</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProviderDisabled</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">CheckGpsStatus</span><span class="o">()</span> <span class="o">{</span>

        <span class="n">locationManager</span> <span class="o">=</span> <span class="o">(</span><span class="nc">LocationManager</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="nc">Context</span><span class="o">.</span><span class="na">LOCATION_SERVICE</span><span class="o">);</span>

        <span class="nc">GpsStatus</span> <span class="o">=</span> <span class="n">locationManager</span><span class="o">.</span><span class="na">isProviderEnabled</span><span class="o">(</span><span class="nc">LocationManager</span><span class="o">.</span><span class="na">GPS_PROVIDER</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">writtenTo</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">saveToFileName</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">writeToFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span><span class="c1">//},Context context) {</span>
        <span class="k">try</span> <span class="o">{</span>


            <span class="nc">File</span> <span class="n">extStore</span> <span class="o">=</span> <span class="nc">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">();</span>
            <span class="c1">//https://stackoverflow.com/questions/34111692/outputstreamwriter-append-not-appending-text-to-a-text-file-android-programming</span>
            <span class="nc">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">extStore</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">()</span> <span class="o">+</span> <span class="s">"/Download/"</span> <span class="o">+</span> <span class="n">saveToFileName</span><span class="o">);</span>
            <span class="nc">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">writtenTo</span><span class="o">);</span>
            <span class="nc">OutputStreamWriter</span> <span class="n">outputStreamWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OutputStreamWriter</span><span class="o">(</span><span class="n">fos</span><span class="o">);</span>

            <span class="n">outputStreamWriter</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">data</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
            <span class="n">outputStreamWriter</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>


            <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"Exception"</span><span class="o">,</span> <span class="n">extStore</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">()</span> <span class="o">+</span> <span class="s">"/Download/"</span> <span class="o">+</span> <span class="n">saveToFileName</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">getFilesDir</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"Exception"</span><span class="o">,</span> <span class="s">"File write failed: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">""</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isExternalStorageWritable</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">state</span> <span class="o">=</span> <span class="nc">Environment</span><span class="o">.</span><span class="na">getExternalStorageState</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">Environment</span><span class="o">.</span><span class="na">MEDIA_MOUNTED</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">state</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">WRITE_REQUEST_CODE</span> <span class="o">=</span> <span class="mi">43</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Intent</span> <span class="nf">createFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">mimeType</span><span class="o">,</span> <span class="nc">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="nc">Intent</span><span class="o">.</span><span class="na">ACTION_CREATE_DOCUMENT</span><span class="o">);</span>

        <span class="c1">// Filter to only show results that can be "opened", such as</span>
        <span class="c1">// a file (as opposed to a list of contacts or timezones).</span>
        <span class="n">intent</span><span class="o">.</span><span class="na">addCategory</span><span class="o">(</span><span class="nc">Intent</span><span class="o">.</span><span class="na">CATEGORY_OPENABLE</span><span class="o">);</span>

        <span class="c1">// Create a file with the requested MIME type.</span>
        <span class="n">intent</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="n">mimeType</span><span class="o">);</span>
        <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="nc">Intent</span><span class="o">.</span><span class="na">EXTRA_TITLE</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
        <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="no">WRITE_REQUEST_CODE</span><span class="o">);</span>
        <span class="nc">Integer</span> <span class="n">resultCode</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

        <span class="n">onActivityResult</span><span class="o">(</span><span class="no">WRITE_REQUEST_CODE</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">intent</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">intent</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="n">textView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">tv_details</span><span class="o">);</span>

        <span class="nc">Integer</span> <span class="n">dd</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>
        <span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">requestPermissions</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span>
                <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_PHONE_STATE</span><span class="o">,</span>
                <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_SMS</span><span class="o">,</span>
                <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_COARSE_LOCATION</span><span class="o">,</span>
                <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_FINE_LOCATION</span><span class="o">,</span>
                <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">WRITE_EXTERNAL_STORAGE</span><span class="o">},</span> <span class="n">dd</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="no">READ_SMS</span><span class="o">)</span> <span class="o">==</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span> <span class="o">&amp;&amp;</span>
                <span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="no">ACCESS_COARSE_LOCATION</span><span class="o">)</span> <span class="o">==</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span> <span class="o">&amp;&amp;</span>
                <span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="no">READ_PHONE_STATE</span><span class="o">)</span> <span class="o">==</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span><span class="o">)</span> <span class="o">{</span>


            <span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">requestPermissions</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="no">READ_SMS</span><span class="o">,</span> <span class="no">READ_PHONE_STATE</span><span class="o">,</span> <span class="no">ACCESS_COARSE_LOCATION</span><span class="o">,</span> <span class="no">WRITE_EXTERNAL_STORAGE</span><span class="o">},</span> <span class="n">dd</span><span class="o">);</span>
            <span class="kd">final</span> <span class="nc">TelephonyManager</span> <span class="n">telephonyManager</span> <span class="o">=</span> <span class="o">(</span><span class="nc">TelephonyManager</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="nc">Context</span><span class="o">.</span><span class="na">TELEPHONY_SERVICE</span><span class="o">);</span>


            <span class="n">context</span> <span class="o">=</span> <span class="n">getApplicationContext</span><span class="o">();</span>
            <span class="nc">CheckGpsStatus</span><span class="o">();</span>
            <span class="n">locationManager</span> <span class="o">=</span> <span class="o">(</span><span class="nc">LocationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="nc">Context</span><span class="o">.</span><span class="na">LOCATION_SERVICE</span><span class="o">);</span>
            <span class="n">criteria</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Criteria</span><span class="o">();</span>
            <span class="nc">Holder</span> <span class="o">=</span> <span class="n">locationManager</span><span class="o">.</span><span class="na">getBestProvider</span><span class="o">(</span><span class="n">criteria</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">GpsStatus</span> <span class="o">==</span> <span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="nc">Holder</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span>
                            <span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span>
                            <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_FINE_LOCATION</span><span class="o">)</span> <span class="o">!=</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span>
                            <span class="o">&amp;&amp;</span>
                            <span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">ACCESS_COARSE_LOCATION</span><span class="o">)</span>
                                    <span class="o">!=</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">return</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="n">locationManager</span><span class="o">.</span><span class="na">getLastKnownLocation</span><span class="o">(</span><span class="nc">Holder</span><span class="o">);</span>
                    <span class="n">locationManager</span><span class="o">.</span><span class="na">requestLocationUpdates</span><span class="o">(</span><span class="nc">Holder</span><span class="o">,</span> <span class="mi">12000</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>


            <span class="n">writtenTo</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>


            <span class="n">saveToFileName</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyyMMddHHmm'.txt'"</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
            <span class="n">saveToFileName</span> <span class="o">=</span> <span class="s">"measurements"</span> <span class="o">+</span> <span class="n">saveToFileName</span><span class="o">;</span>
            <span class="kd">final</span> <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="n">createFile</span><span class="o">(</span><span class="s">"text/plain"</span><span class="o">,</span> <span class="n">saveToFileName</span><span class="o">);</span>

            <span class="kd">final</span> <span class="kt">boolean</span><span class="o">[]</span> <span class="n">complete</span> <span class="o">=</span> <span class="o">{</span><span class="kc">false</span><span class="o">};</span>
            <span class="kd">final</span> <span class="nc">Integer</span><span class="o">[]</span> <span class="n">counter</span> <span class="o">=</span> <span class="o">{</span><span class="mi">0</span><span class="o">};</span>
            <span class="kd">final</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">fileName</span> <span class="o">=</span> <span class="o">{</span><span class="s">""</span><span class="o">};</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">();</span>
            <span class="n">test</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">complete</span><span class="o">[</span><span class="mi">0</span><span class="o">])</span> <span class="o">{</span>
                        <span class="n">counter</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">counter</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>

                        <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">counter</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">location</span><span class="o">.</span><span class="na">getLongitude</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">location</span><span class="o">.</span><span class="na">getLatitude</span><span class="o">()</span> <span class="o">+</span> <span class="n">telephonyManager</span><span class="o">.</span><span class="na">getAllCellInfo</span><span class="o">();</span>
                            <span class="n">fileName</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">writeToFile</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
                            <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
                            <span class="n">handler</span><span class="o">.</span><span class="na">postDelayed</span><span class="o">(</span><span class="n">test</span><span class="o">,</span> <span class="mi">1000</span><span class="o">);</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">counter</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="mi">3600</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">fileName</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
                                <span class="n">handler</span><span class="o">.</span><span class="na">removeCallbacks</span><span class="o">(</span><span class="n">test</span><span class="o">);</span>

                            <span class="o">}</span>
                        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                            <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"Exception"</span><span class="o">,</span> <span class="s">"waiting"</span><span class="o">);</span>
                            <span class="nc">File</span> <span class="n">extStore</span> <span class="o">=</span> <span class="nc">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">();</span>
                            <span class="nc">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">extStore</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">()+</span><span class="s">"/Download/"</span><span class="o">+</span><span class="n">saveToFileName</span><span class="o">);</span>
                            <span class="n">complete</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">();</span>
                            <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"Exception"</span><span class="o">,</span><span class="s">""</span><span class="o">+</span><span class="n">extStore</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
                            <span class="n">handler</span><span class="o">.</span><span class="na">postDelayed</span><span class="o">(</span><span class="n">test</span><span class="o">,</span> <span class="mi">1000</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">};</span>
                <span class="n">handler</span><span class="o">.</span><span class="na">postDelayed</span><span class="o">(</span><span class="n">test</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>

        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">requestPermissions</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="no">READ_SMS</span><span class="o">,</span> <span class="no">READ_PHONE_STATE</span><span class="o">,</span><span class="no">ACCESS_COARSE_LOCATION</span><span class="o">,</span><span class="no">ACCESS_FINE_LOCATION</span><span class="o">},</span> <span class="n">dd</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>The application when run on your phone(tested on Android 6.0) immediately prompts to save a file to a directory(the default file name is to be left unmodified). After creating the file the app displays the text being appended every single second to the created file. The app has no real UI - I wanted to get to analysis ASAP and this stackoverflow assisted creation was sufficient for that objective. A sample logged line is below:</p>

<figure class="highlight"><pre><code class="language-plaintext" data-lang="plaintext">1569105778657 258 LAT LON[CellInfoLte:{mRegistered=YES mTimeStampType=oem_ril mTimeStamp=10331753480921ns CellIdentityLte:{ mMcc=302 mMnc=220 mCi=XXXXXX mPci=155 mTac=4340} CellSignalStrengthLte: ss=20 rsrp=-155 rsrq=-8 rssnr=14 cqi=255 ta=0}]</code></pre></figure>

<p>The first number is the timestamp and second number signifies that this line is the <code class="language-plaintext highlighter-rouge">258</code>th logged entry (approximately <code class="language-plaintext highlighter-rouge">258</code> seconds after starting the app). <code class="language-plaintext highlighter-rouge">LAT</code> and <code class="language-plaintext highlighter-rouge">LON</code> are place holders for the GPS location which have been anonymized (along with <code class="language-plaintext highlighter-rouge">mCI</code>) and the rest of the line is information on the cell signal. The relevant stuff are the CellSignalStrength and specifically <code class="language-plaintext highlighter-rouge">ss</code> measured in <code class="language-plaintext highlighter-rouge">dB</code>. The signal strength will be primarily used for finding the tower. Sometimes the cell phone will pick up multiple signals and so the there will be multiple <code class="language-plaintext highlighter-rouge">CellInfoLte</code> entries within the square brackets. Based on <a href="https://www.cellmapper.net/CellMapper_CSV">this</a> some of the <code class="language-plaintext highlighter-rouge">CellIdentityLte</code> are identified as</p>

<figure class="highlight"><pre><code class="language-plaintext" data-lang="plaintext">mMcc: Mobile Country Code
mMnc: Mobile Network Code
mCi:  Mobile Cell ID
mPci: Physical Cell Identity </code></pre></figure>

<p>These codes are used to identify the tower. The <code class="language-plaintext highlighter-rouge">CellSignalStrengthLte</code> is broken down <a href="https://usatcorp.com/faqs/understanding-lte-signal-strength-values/">here</a>:</p>

<figure class="highlight"><pre><code class="language-plaintext" data-lang="plaintext">ss:    Signal Strength
rsrp:  Reference Signal Receive Power: The average power received from a single Reference signal, and Its typical range is around -44dbm (good) to -140dbm(bad).
rsrq:  Reference Signal Recieved Quality: Indicates quality of the received signal, and its range is typically -19.5dB(bad) to -3dB (good).
rssnr: reference signal signal-to-noise ratio
cqi:   channel quality indicator 
ta:    Get the timing advance value for LTE, as a value in range of 0..1282</code></pre></figure>

<p>I used a python script (<code class="language-plaintext highlighter-rouge">parseCellData.py</code>) to analyze the text files</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>


<span class="k">class</span> <span class="nc">Recording</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">latitude</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">longitude</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">cells</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">ss</span><span class="o">=</span><span class="mi">0</span>

    <span class="k">def</span> <span class="nf">setLatitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lat</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">latitude</span><span class="o">=</span><span class="n">lat</span>
    <span class="k">def</span> <span class="nf">getLatitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">latitude</span>

    <span class="k">def</span> <span class="nf">setLongitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lon</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">longitude</span><span class="o">=</span><span class="n">lon</span>
    <span class="k">def</span> <span class="nf">getLongitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">longitude</span>

    <span class="k">def</span> <span class="nf">setCoordinateTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">time</span><span class="o">=</span><span class="n">time</span>
    <span class="k">def</span> <span class="nf">addCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cell</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">cells</span>


<span class="k">class</span> <span class="nc">cellData</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="s">""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">ss</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sp</span><span class="o">=</span><span class="mi">0</span>

    <span class="k">def</span> <span class="nf">setTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">time</span><span class="o">=</span><span class="n">time</span>
    
    <span class="k">def</span> <span class="nf">setID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ID</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">ID</span><span class="o">=</span><span class="n">ID</span>
    <span class="k">def</span> <span class="nf">getID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">ID</span>
    
    <span class="k">def</span> <span class="nf">setSignalStrength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ss</span><span class="p">):</span>
        <span class="c1">#https://stackoverflow.com/questions/7201871/getgsmsignalstrength-return-values-that-are-out-of-range
</span>        <span class="k">if</span><span class="p">(</span><span class="n">ss</span><span class="o">==</span><span class="mi">99</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">ss</span><span class="o">=</span><span class="mi">0</span><span class="c1">#null
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">ss</span><span class="o">=-</span><span class="mi">113</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span>

    <span class="k">def</span> <span class="nf">getSignalStrength</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">ss</span>
    
    <span class="k">def</span> <span class="nf">getSignalPower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">sp</span>

    <span class="k">def</span> <span class="nf">setSignalPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sp</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sp</span><span class="o">=</span><span class="n">sp</span>



<span class="k">class</span> <span class="nc">analyze</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coordinates</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span>

    <span class="k">def</span> <span class="nf">getLats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lats</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">coordinates</span><span class="p">:</span>
            <span class="n">lats</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">getLatitude</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">lats</span>

    <span class="k">def</span> <span class="nf">getLons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lons</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">coordinates</span><span class="p">:</span>
            <span class="n">lons</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">getLongitude</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">lons</span>
    <span class="k">def</span> <span class="nf">getUniqueTowers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tower</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">coordinates</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cellTower</span> <span class="ow">in</span> <span class="n">coord</span><span class="p">.</span><span class="n">getCells</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cellTower</span><span class="p">.</span><span class="n">getID</span><span class="p">()</span> <span class="ow">in</span> <span class="n">tower</span><span class="p">:</span>
                    <span class="n">tower</span><span class="p">[</span><span class="n">cellTower</span><span class="p">.</span><span class="n">getID</span><span class="p">()]</span> <span class="o">=</span> <span class="n">tower</span><span class="p">[</span><span class="n">cellTower</span><span class="p">.</span><span class="n">getID</span><span class="p">()]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tower</span><span class="p">[</span><span class="n">cellTower</span><span class="p">.</span><span class="n">getID</span><span class="p">()]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">tower</span>
    <span class="k">def</span> <span class="nf">getTowerCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">towerID</span><span class="p">):</span>
        <span class="n">lats</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">lons</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">coordinates</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cellTower</span> <span class="ow">in</span> <span class="n">coord</span><span class="p">.</span><span class="n">getCells</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cellTower</span><span class="p">.</span><span class="n">getID</span><span class="p">()</span> <span class="o">==</span> <span class="n">towerID</span><span class="p">:</span>
                    <span class="n">lats</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">.</span><span class="n">getLatitude</span><span class="p">())</span>
                    <span class="n">lons</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">.</span><span class="n">getLongitude</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">lats</span><span class="p">,</span><span class="n">lons</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getAllTowerCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">towers</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">getUniqueTowers</span><span class="p">()</span>
        <span class="n">towerList</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">coords</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">tower</span> <span class="ow">in</span> <span class="n">towers</span><span class="p">:</span>
            <span class="n">towerList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">tower</span><span class="p">)</span>
            <span class="n">coord</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">getTowerCoords</span><span class="p">(</span><span class="n">tower</span><span class="p">)</span>
            <span class="n">coords</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">towerList</span><span class="p">,</span> <span class="n">coords</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getSignalStrengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tower</span><span class="p">):</span>
        <span class="n">signalStrengths</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">coordinates</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cellTower</span> <span class="ow">in</span> <span class="n">coord</span><span class="p">.</span><span class="n">getCells</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cellTower</span><span class="p">.</span><span class="n">getID</span><span class="p">()</span> <span class="o">==</span> <span class="n">tower</span><span class="p">:</span>
                    <span class="n">signalStrengths</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">cellTower</span><span class="p">.</span><span class="n">getSignalStrength</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">signalStrengths</span>

    <span class="k">def</span> <span class="nf">getSignalPowers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tower</span><span class="p">):</span>
        <span class="n">signalPowers</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">coordinates</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cellTower</span> <span class="ow">in</span> <span class="n">coord</span><span class="p">.</span><span class="n">getCells</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cellTower</span><span class="p">.</span><span class="n">getID</span><span class="p">()</span> <span class="o">==</span> <span class="n">tower</span><span class="p">:</span>
                    <span class="n">signalPowers</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">cellTower</span><span class="p">.</span><span class="n">getSignalPower</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">signalPowers</span>


    <span class="k">def</span> <span class="nf">sortByIncreasingFrequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">towerCoords</span><span class="p">):</span>
        <span class="n">arr</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">towerCoords</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">arr</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">copy</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">copyID</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)):</span>
            <span class="n">copy</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">towerCoords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="n">copyID</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">towerCoords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">copyID</span><span class="p">,</span><span class="n">copy</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">readCellInformation</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">coordinates</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">def</span> <span class="nf">getCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">coordinates</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fileName</span><span class="p">):</span>
        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">=</span><span class="n">f</span><span class="p">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'['</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
            <span class="n">coordinate_data</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="n">Recording</span><span class="p">()</span>
            <span class="n">rec</span><span class="p">.</span><span class="n">setLatitude</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">coordinate_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">rec</span><span class="p">.</span><span class="n">setLongitude</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">coordinate_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">rec</span><span class="p">.</span><span class="n">setCoordinateTime</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">coordinate_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">"CellInfoLte"</span><span class="p">,</span><span class="s">"CELL"</span><span class="p">)</span>
            <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">"CellInfoWcdma"</span><span class="p">,</span><span class="s">"CELL"</span><span class="p">)</span>
            <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="s">"CellInfoGsm"</span><span class="p">,</span><span class="s">"CELL"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">'CELL:'</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
 
                    <span class="n">time</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">'mTimeStamp=(.*)ns'</span><span class="p">,</span><span class="n">y</span><span class="p">).</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">mcc</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">'mMcc=(.*) mMnc'</span><span class="p">,</span><span class="n">y</span><span class="p">).</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">mnc</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">'mMnc=(.*) (mCi|mLac)='</span><span class="p">,</span><span class="n">y</span><span class="p">).</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">mci</span><span class="o">=</span><span class="s">""</span>
                    <span class="n">mpci</span><span class="o">=</span><span class="s">""</span>
                    <span class="c1">#mtac=int(re.search('mTac=(.*)} Cell',y).group(1))
</span>                    <span class="n">tmp</span><span class="o">=</span><span class="s">""</span>
                    <span class="n">tmp</span><span class="o">=</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">'ss=(.*) rsrp='</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
                    <span class="n">cell</span> <span class="o">=</span> <span class="n">cellData</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span><span class="c1">#LTE
</span>                        <span class="n">mci</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">'mCi=(.*) mPci='</span><span class="p">,</span><span class="n">y</span><span class="p">).</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                        <span class="n">tmp</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                        <span class="n">rsrp</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">'rsrp=(.*) rsrq='</span><span class="p">,</span><span class="n">y</span><span class="p">).</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                        <span class="n">cell</span><span class="p">.</span><span class="n">setSignalPower</span><span class="p">(</span><span class="n">rsrp</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span><span class="c1">#WCDMA
</span>                        <span class="n">tmp</span><span class="o">=</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">' ss=(.*) ber='</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">mci</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">'mCid=(.*) mPsc='</span><span class="p">,</span><span class="n">y</span><span class="p">).</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">mci</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">'mCid=(.*)} CellSignalStrengthGsm'</span><span class="p">,</span><span class="n">y</span><span class="p">).</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                        <span class="n">tmp</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">ss</span><span class="o">=</span><span class="n">tmp</span> 
                    <span class="n">ID</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">mpci</span><span class="p">)</span><span class="o">+</span><span class="s">""</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">)</span>
                    
                    <span class="n">cell</span><span class="p">.</span><span class="n">setTime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
                    <span class="n">cell</span><span class="p">.</span><span class="n">setID</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
                    <span class="n">cell</span><span class="p">.</span><span class="n">setSignalStrength</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
                    <span class="n">rec</span><span class="p">.</span><span class="n">addCell</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">coordinates</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>            </code></pre></figure>

<p>Useful posts for tracking cell phone towers based on cell signal strength:</p>

<ol>
  <li><a href="https://engineering.stackexchange.com/questions/10987/how-to-determine-signal-strength-verses-distance-for-lte-base-stations/11049">Engineering stack exchange</a> was one of the first discovered. It was discouraging to say the least. It looked like I needed to read a lot more and discover more parameters in order to find the cell tower. (related: <a href="https://networkengineering.stackexchange.com/questions/60813/calculating-maximum-distance-for-receiving-lte-signal">link</a>)</li>
  <li><a href="https://stackoverflow.com/questions/11217674/how-to-calculate-distance-from-wifi-router-using-signal-strength">Stack overflow</a> discusses computing computing distances in the wifi context. The formulas looked simple enough, but wasn’t sure how to extend it to my context.</li>
  <li><a href="https://stackoverflow.com/questions/10329877/how-to-properly-triangulate-gsm-cell-towers-to-get-a-location">Stack overflow</a> Discussed computing an individual’s location given that the cell tower locations and signal strengths are known. This gave inspiration for using the computer cell tower locations later on.</li>
  <li><a href="https://stackoverflow.com/questions/9630297/how-to-get-cell-tower-location-in-android#9630589">Stack overflow</a>,<a href="https://stackoverflow.com/questions/6668271/get-cell-tower-locations-android">Stack overflow</a> discovered the cell tower locations by looking them up in a public database (given that they are even available). This seemed like a cop out. There were already resources listing displaying cell tower locations across Canada - I wanted to derive it myself.</li>
  <li><a href="https://en.wikipedia.org/wiki/Free-space_path_loss">Free-space path loss</a> concept was mentioned in previous posts. The wikipedia article like the engineering stack exchange post left me with more questions than answers.</li>
  <li><a href="https://personal.utdallas.edu/~torlak/courses/ee4367/lectures/lectureradio.pdf">These lecture slides notes</a> and <a href="https://www.engeniustech.com/explaining-free-space-path-loss/">this</a> started to give me the sense that I needed to look more at Free-space path loss.</li>
  <li><a href="https://doi.org/10.1145/3308558.3313726">Paper 1</a>, <a href="https://ieeexplore.ieee.org/abstract/document/5683779/">Paper 2</a> gave more insight into using towers to locate cell phone location as well as signal strength maps(something that I am trying to recreate with my walks and car ride - could I reverse engineer somehow?)</li>
  <li><a href="https://doi.org/10.1007/11853565_14">Paper 3</a> provided break through. The paper described creating a positioning system based on cell towers. Since they did not have access to cell tower locations had to locate themselves. To collect data, they drove over <code class="language-plaintext highlighter-rouge">4000km</code> - covering a <code class="language-plaintext highlighter-rouge">25km by 18km</code>. A lot more than I plan to do since I am stationed in a small town, but still daunting. They did not know the cell phone tower locations to begin with and ended up estimating their location based on “averaging  the  places  where  the  highest  signal  strengths  in  each  cell  was  observed”.  This adhoc approach provided average error of <code class="language-plaintext highlighter-rouge">56m</code> and maximum <code class="language-plaintext highlighter-rouge">76m</code>. The error for positioning using the calculated cell towers was significant and for GPS would be unacceptable.</li>
  <li><a href="https://doi.org/10.1145/1864349.1864384">Paper 4</a>. The previous paper was dated 2006 - looking at authors who have cited the paper a 2010 entry was found. This described the process of recording data around town as wardriving!!! Lots of useful information to consider. There are two algorithms considered and compared - the average approach (from previous point) and another. The conclusion was “blindly applying these algorithms to estimate cell tower positions results in very large errors”. They introduced approach to avoid the errors, but for the small town I’m in, I hope it will be unnecessary.</li>
  <li><a href="http://ermis.tucserv.tuc.gr/techReportPFs.pdf">Paper 5</a> from 2013 provided another approach but it was not for me.</li>
  <li><a href="https://stackoverflow.com/questions/13547085/approx-distance-to-nearest-mobile-mast">Stack overflow</a> The new approach mentioning using <code class="language-plaintext highlighter-rouge">TA</code> parameter (time advance), but due to (apparent) tower difference this value was always zero for me and therefore not useful. <a href="https://www.panix.com/~mpoly/android/antennas/r1.0/">link</a> mentioned Google building their database of cell tower locations via “crowdsourcing”.</li>
  <li><a href="https://en.wikipedia.org/wiki/Hata_model">Hata model</a> free-space path loss led me here. Models are used by telecom companies to predict areas where coverage is low/high in order to optimize tower placement. This led me to the idea that by matching these models to the data, I can estimate the tower locations based on signal decay rate.</li>
  <li><a href="https://arxiv.org/pdf/1110.1519.pdf">Model comparison</a> - compared different models including Hata. I was unfamiliar with some of the terms so I sought an easier explanation: a <a href="https://pdfs.semanticscholar.org/6901/8cae891d502eb9afdb6c7218bdee53104b10.pdf">thesis</a> on the topic (great source!!!).</li>
</ol>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

	<div class="wrapper">

		<!--<p style="color:grey">Welcome to my site. Take a look around and don't be shy, shoot me a message!</p>-->
	</div>
  <div class="wrapper">

    <h2 class="footer-heading">Stan Zonov</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-2">
        <ul class="contact-list">
          <!--<li>Stan Zonov</li>-->
          <li>hello at szonov.com</li>
        </ul>
      </div>

      <div class="footer-col  footer-col-1">
	     
        <ul class="social-media-list">
	   <!--
            <p>

<span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
																	<g transform="scale(0.035)">
                  <path fill="#828282" d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z"/>
																</g>
                </svg>
              </span>

              <span class="username">hello at szonov.com</span>
	    </p>
	    </li>-->


          

          


          


        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text"></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
