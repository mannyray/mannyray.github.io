<!DOCTYPE html>
<html>

  <head>
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>The Bionicle Man</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://szonov.com/programming/2023/12/25/the-bionicle-man/">
  <link rel="alternate" type="application/rss+xml" title="Stan Zonov" href="https://szonov.com/feed.xml" />
</head>


  <body>
	
    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Stan Zonov</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
	<a class="page-link" href=""></a>
        
		
			<a class="page-link" href="/about/">About</a>
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			
		
        
		
			<a class="page-link" href="/photos/">Photos</a>
		
        
	<a class="page-link" href="/">Blog</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
 	 
    <h1 class="post-title">The Bionicle Man</h1>
    <p class="post-meta">Dec 25, 2023</p>
  </header>

  <article class="post-content">
    <body>
<p style="height:0px;width:0px"></p>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
    .toc_and_content_table{
        border: none;
    }
    .toc {
        width: 25%;
        vertical-align:top;
        border: none;
        padding:0px;
        border: none;
    }
    .content {
        padding: 10px;
        border: none;
    }
    .scrollable{
        height: auto;        /* Allow it to grow based on content */
        max-height: 100vh;
        overflow-y: auto;
    }
    .sticky-top {
        position: -webkit-sticky;
        position: sticky;
        top: 0;
        background: #fff; /* Background for the sticky menu */
    }
    #menu {
        list-style-type: none; /* Remove bullets */
        padding: 0; /* Remove padding */
        margin: 0; /* Remove margin */
    }
    #menu li {
        margin: 5px 0; /* Space between bars */
        position: relative
    }
    #menu a {
        display: block; /* Make the link a block element */
        padding: 2px; /* Space inside the bars */
        background: #f0f0f0; /* Light gray background for bars */
        text-decoration: none; /* Remove underline */
        color: #333; /* Text color */
        border-radius: 4px; /* Rounded corners */
        transition: background 0.3s; /* Smooth background transition */
    }
    #menu a:hover {
        background: #e0e0e0; /* Darker gray on hover */
    }
    .active {
        font-weight: bold;
        color: blue; /* Change the color for highlighting */
    }
    .active::after {
        content: '';
        position: absolute;
        top: 0;
        border-radius: 4px;
        left: 0;
        height: 100%;
        width: 100%;
        background: #007bff; /* Active background color */
        transform: scaleX(0); /* Start with no width */
        transform-origin: left; /* Scale from the left */
        animation: load 0.5s forwards; /* Loading animation */
        background: rgba(0, 123, 255, 0.5); /* Semi-transparent active background color */
    }
    @keyframes load {
        0% {
            transform: scaleX(0); /* Start with no width */
        }
        70% {
            transform:  scaleX(1); /* Scale to full width */
        }
        85% {
            transform: scaleX(0.95); /* Bounce effect */
        }
        100% {
            transform: scaleX(1); /* Return to full width */
        }
    }
    .section {
        border: 0;
        height: 100%;
        margin: 0;
        padding: 0;
        width: 100%;
    }
    
    .desktop-only {
        display: none;
    }
    /* Show mobile paragraph on mobile devices */
    .mobile-only {
        display: block;
    }
    /* Media query for non-mobile devices */
    @media (min-width: 768px) {
        .desktop-only {
            display: block;
        }
        .mobile-only {
            display: none;
        }
    }
    
    /* mobile version*/
    .popup-button {
        font-size: 24px;
        position: fixed;
        top: 50%;
        right: 0;
        transform: translateY(-50%); /* Center vertically */
        padding: 10px 20px;
        background-color: #f0f0f0;
        border-radius: 5px;
        cursor: pointer;
        opacity: 0; /* Start invisible */
        visibility: hidden; /* Initially hidden */
        transition: opacity 0.5s ease, visibility 0.5s ease; /* Fade effect */
    }
    .popup-button.show {
        opacity: 1; /* Fully visible */
        visibility: visible; /* Make it visible */
    }
    .target-section {
        background-color: #f0f0f0;
    }
    .sidebar {
        position: fixed;
        right: 0; /* Align sidebar directly to the right edge */
        width: 200px; /* Set the width of the sidebar */
        max-height: 80vh; /* Limit height for scrolling */
        background: #fff; /* Background for the sidebar */
        padding: 10px; /* Padding inside the sidebar */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
        z-index: 1000; /* Ensure it appears above other elements */
        transform: translate(0, -50%) scale(0); /* Start hidden and minimized */
        transform-origin: right center; /* Scale from the right */
        transition: transform 0.3s ease, visibility 0.5s ease; /* Smooth transition */
        visibility: hidden; /* Initially hidden */
        border: 1px solid #ccc; /* Add a border */
        border-radius: 8px; /* Slightly rounded corners */
    }
    .sidebar.show {
        transform: translate(0, -50%) scale(1); /* Show the sidebar */
        visibility: visible; /* Make it visible */
    }
    .sidebar h3 {
        margin: 0; /* Remove default margin */
        padding: 0; /* Remove default padding */
        height: 40px; /* Set height for better alignment */
    }
    .mobile-scrollable{
        height: auto;        /* Allow it to grow based on content */
        max-height: 70vh;
        overflow-y: auto;
    }
</style>
                    <div class="desktop-only">
                    <table class="toc_and_content_table">
                    <tr>
                    <td class="toc">
                    <div class="sticky-top">
                    <h3>
<i class="fa fa-list-ol"></i> Contents</h3>
                    <div class="scrollable">
                    <ul id="menu">
                    <li><a href="#section-introduction-1" onclick="event.preventDefault(); document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });">Introduction</a></li>
  <li><a href="#section-heart-rate-variability-1" onclick="event.preventDefault(); document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });">Heart Rate Variability</a></li>
  <li><a href="#section-the-watch-app-1" onclick="event.preventDefault(); document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });">The Watch App</a></li>
  <li><a href="#section-coding-it-up-1" onclick="event.preventDefault(); document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });">Coding It Up</a></li>
  <li><a href="#section-conclusion-1" onclick="event.preventDefault(); document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });">Conclusion</a></li>
                    </ul>
                    </div>
                    </div>
                    </td>
                    <td class="content">
                    <!--toc_start-->

<div id="section-introduction-1" class="section"><div>
<hr>
<h2 id="introduction-1">Introduction</h2>

<p>Hello dear reader! I am writing a new blog post as it would be amiss of me to miss adding a single post in the fading year of two thousand and twenty-three. During a small part of this busy busy year I have been preoccupied with my Garmin watch. My first watch model was a gift, and I initially thought it was a silly thing until I started using it.</p>

<p>Garmin watches allow you to track your heart rate and GPS coordinates. This allows you to understand how hard you are exerting yourself and how far you went when running, cycling, swimming, etcetera. Garmin’s data sharing ability allows you to share this information with friends in order to see what new bike routes or challenges your friends have completed. This social aspect for me was the primary benefit of the watch, represented in thoughts such as: <em>“…wait what?… so and so biked 40km across a frozen lake on a fat bike?”</em> and <em>“That’s an interesting cycling route. I will try that out tomorrow.”</em></p>

<p>You may be thinking: <em>“…ah another tracking mechanism that I don’t care for”</em> or <em>“who has got time or knowledge to view and make use of these metrics?”</em>. These are valid concerns, but the watch is what you make of it. I found the watch great for helping me become more mindful of my breath control during exercise, <a href="https://www.youtube.com/watch?v=-6PDBVRkCKc">training in specific heart rate zones</a>, and changing up my exercise routes. The watches are now so advanced that they even come with a GPS map that can assist you in some of your longer <a href="https://www.youtube.com/watch?v=wESL8G1pNIU">routes</a> - the technology is very advanced!</p>

</div></div>
<div id="section-heart-rate-variability-1" class="section"><div>
<hr>
<h2 id="heart-rate-variability-1">Heart Rate Variability</h2>

<p>Outside of social and exercise metrics, I wasn’t receiving too much information about my body. It wasn’t until I upgraded to the <a href="https://www.garmin.com/en-CA/p/777730">955 Solar Garmin watch</a> that I started getting some additional metrics, such as <a href="https://support.garmin.com/en-CA/?faq=WT9BmhjacO4ZpxbCc0EKn9">stress level</a>. At first I was very confused by this variable. How is it that I am sitting down, and this watch is claiming that I am stressed at a stress level of 80 out of 100… during a vacation where I do, and should feel calm?</p>

<p>The stress metric is based on the heart rate and <a href="https://medium.com/@altini_marco/the-ultimate-guide-to-heart-rate-variability-hrv-part-1-70a0a392fff4">heart rate variability (hrv)</a>. <a href="https://www.garmin.com/en-US/garmin-technology/health-science/stress-tracking/">Garmin</a> scales the metrics from 0 to 100 in order of increasing stress. Below is a sample image of Garmin watch view of my stress during a morning where I had to go for an early flight. The calm, blue, below 25 stress occured when I was sleeping on the plane.</p>

<p><img src="https://szonov.com/assets/watch_images/stress_view.jpg" alt=""></p>

<p>The stress metric was not immediately available from the watch’s resting face, and I had to press one of the side buttons to see the live data. I was so preoccupied with all of this that my friend nicknamed me the “Bionicle Man”. Half man, half robot - obsessed and hunched over my watch, looking at my metrics throughout all moments of the vacation.</p>

</div></div>
<div id="section-the-watch-app-1" class="section"><div>
<hr>
<h2 id="the-watch-app-1">The Watch App</h2>

<p>I decided to combine my old love for little programming projects with this new found curiosity in the dynamic stress metric. Fortunately, Garmin has a wonderful <a href="https://developer.garmin.com/">software development kit</a> and <a href="https://forums.garmin.com/developer/connect-iq/">detailed forums</a> that allows one to create their own watch faces and apps. I set out to create a stress monitoring watch!</p>

<p>Unfortunately, when programming the watch face, <a href="https://forums.garmin.com/developer/connect-iq/f/discussion/286382/stress-and-heart-rate-in-low-power-mode">one cannot get access to a ‘live’ stress metric</a>. Therefore, I used the next best thing for displaying live stress data, which was the live heart rate, as these two fields are correlated. I created a watch face with a graph that displayed the heart rate for the past three minutes, and that refreshed every second. I colour coded the heart rate in the graph in order to communicate to the user when their heart rate was exceeding a resting rate. Take a look at the resulting watch face:</p>

<p><img src="https://szonov.com/assets/watch_images/cropped.gif" alt=""></p>

<p>This graph allows you to look into the history of your heart rate; to see if your heart rate is accelerating or decelerating. For the gif above, I modified the code to allow for playback of live recorded data, to demonstrate how the watch face works (it’s not actually measuring the pulse of the table). For the represented data, I started in a sitting position, stood up did some jumping jacks, and at last I sat back down. My heart started at a resting rate in the 40’s/50’s and then went up to the 90’s, and then went back down to resting. The gif shows minute by minute updates. The live scroll can only last <a href="https://forums.garmin.com/outdoor-recreation/outdoor-recreation/f/fenix-7-series/291191/hi-power-mode/1405564#1405564">10 seconds at a time</a>, when the watch is ‘active’, due to a strict battery saving restriction implemented by Garmin. During the live scroll, the graph shifts pixel by pixel, with the right most data containing the latest heart rate. If you want the latest graph data at any time, then you just have to ‘activate’ your watch using the wrist gesture (demonstrated below - as the watch is activated the screen turns on and the graph starts displaying live heart data and at the end the watch goes back to ‘sleep’ mode).</p>

<p><img src="https://szonov.com/assets/watch_images/activate_watch.gif" alt=""></p>

<p>Outside of my heart rate during jumping jacks, I observed many interesting things. Most captivating to me was my heart rate in a sitting and working context; one’s heart beats per minute can be in the 40’s or the 80’s, all while doing the exact same thing. One’s heart rate can drift away very easily from a steady rest rate to an elevated rate. Get carried away with a thought and next thing you know your heart rate went from the 40’s to the 70’s over the span of a minute. My heart rate is the calmest when I am deeply focused on a topic.</p>

<p>These observations inspired the following two questions: How do I go from one heart rate to another, and how do I become more self aware of my body? I will not go into the details of the experiments that followed these questions, as this is not a health blog, but will mention that breathing techniques were very helpful. Having this new, easy access to my heart rate and its recent history, I was able to learn a lot and continue to learn much.</p>

<p>This observation process worked in a feedback loop; as you read the data that is coming to you about your body, you modify your behaviour (like breathing) or environment, to see if you can register a different response from your body (lower heart rate for example). Yes, it is likely and most definitely true: there are many papers on this topic describing how effective it is or not for tracking stress. However, at the time I was too excited to start coding on this project and decided not to get bogged down in the academic papers, and their potentially uncertain conclusions. <a href="https://www.youtube.com/watch?v=U2RpBeHJ33s">Here</a> is a video of another project dealing with this feedback mechanism.</p>

</div></div>
<div id="section-coding-it-up-1" class="section"><div>
<hr>
<h2 id="coding-it-up-1">Coding It Up</h2>

<p>Programming the watch face was not a linear process. There were many uncertainties and unknowns along the way. For some of these unknowns I was not sure if the project could be finished, while for some others it was just a matter of debugging. Just as my heart rate went up and down, so did my concern for the project’s feasibility. The milestones of uncertainty in order of thought were the following:</p>
<ul>
  <li>“Is programming a custom watch face even possible?”</li>
  <li>“How do I get my environment setup?”</li>
  <li>“How do I get a basic app going?”</li>
  <li>“How do I print some text?”</li>
  <li>“How do I add military time?”</li>
  <li>“How do I transfer the custom watch face to my watch face?”</li>
  <li>“What data structure should I use to store incoming heart rate data?”</li>
  <li>“How do I add some tests to make sure the data structure is solid?”</li>
  <li>“Can I get live stress data for every second?”</li>
  <li>“What about heart data?”</li>
  <li>“How do I deal with this ‘out of memory’ error?”</li>
  <li>“Can I get the watch to display a live graph all the time, or only ten seconds at a time?”</li>
  <li>“How do I make this graph look nice?”</li>
  <li>“How do I add custom fonts to my watch face?”</li>
  <li>“Which colours are available for my watch face and how do I assign them per increasing heart rate range?”</li>
  <li>“How do I align everything on my watch to my taste?”</li>
  <li>“What range of heart rate history should I add to my watch: 10, 5 or 3 minutes?”</li>
  <li>“How do I want to organize and clean up the code to make a public repository to share with others?”</li>
  <li>“What do I want to write in a blog post about the watch face to share with my friends?”</li>
</ul>

<p>I wrote these series of questions down for the non-technical reader (you?) to bring them along with me on this journey. They weren’t really that “serious” or cliff hanger like. For any programming project this is a common process, especially for those projects which are do-it-yourself. I am sure you encounter these thought paths in the various projects you work on. For a more “serious” project I would spend more time in the planning phase - here I was just itching to start coding right away!</p>

<p>For the technical reader, who is looking to create their own watch face, Garmin provides the ability to <a href="https://medium.com/@JoshuaTheMiller/making-a-watchface-for-garmin-devices-8c3ce28cae08">simulate your watch</a> on the computer, so the development becomes very quick. The programming is straight forward, and Github &amp; Garmin forums provide a plethora of examples to assist you in your project. The code I wrote can be found <a href="https://github.com/mannyray/StressWatchFace">here</a>, hosted on github for everyone to use and modify! In regard to the code, I was most satisfied with the the <a href="https://github.com/mannyray/StressWatchFace/blob/master/source/DataLinkedList.mc">data structure</a> used in storing the incoming heart rate. For this structure I used an array as a linked list for ease of handling fresh/stale data, with the added condition that the data entries in the array are equally spaced apart in time, and that there is logic to handle spotty/missing data. In addition, I implemented <a href="https://github.com/mannyray/StressWatchFace/blob/master/source/DataLinkedListTest.mc">tests for the data structure</a> ,to give confidence in its usability, and therefore allow for reuse of the code in other applications with live sensor data. The <a href="https://github.com/mannyray/StressWatchFace/blob/master/source/MannyrayWatchFaceView.mc#L360">graph code here</a> turned out very aesthetically pleasing. I was happy to conquer this, as one of my the concerns when coding up the watch was <em>“will it look good?”</em>.</p>

<p>There are lots of ways to customize the aesthetics of your watch face programmatically. Many other custom watch faces can be found in Garmin’s <a href="https://apps.garmin.com/en-US/">app store</a>, which has all sorts of applications like <a href="https://support.garmin.com/en-CA/?faq=mE1Jmwvzd84s9YuDqa3GB7">finding your phone</a>, <a href="https://apps.garmin.com/en-US/apps/503a3260-3a13-43f4-96d5-081930a46078">finding your car</a>, <a href="https://apps.garmin.com/en-US/apps/d5228d46-886e-49c0-a9bf-7eabd537a8d2">displaying the latest bitcoin price</a>, <a href="https://apps.garmin.com/en-US/apps/00aa0c38-6eed-4822-89b0-01b4bdab2501">marine autopilot</a> and many a styled, refined, and exquisite watch faces to match one’s taste.</p>

</div></div>
<div id="section-conclusion-1" class="section"><div>
<hr>
<h2 id="conclusion-1">Conclusion</h2>

<p>Perhaps some version of my watch face design was already created and lost to time amongst the thousands of other watch faces in the app store. Regardless, I viewed the exercise of creating a watch face very useful to me, as it was a foray into creating other additional Garmin apps and watch faces.</p>

<p>I am still interested in getting access to a ‘live’ stress metric for which I already have already some leading links (<a href="https://github.com/vtrifonov-esfiddle/TestHrv">1</a>, <a href="https://forums.garmin.com/developer/connect-iq/f/discussion/235708/getting-started-in-monkey-c-with-hrv">2</a>, <a href="https://forums.garmin.com/developer/connect-iq/f/discussion/233162/hrv-rr-intervals-api">3</a>). Furthermore, the watch can be connected to custom mobile apps via Garmin’s <a href="https://developer.garmin.com/connect-iq/core-topics/mobile-sdk-for-android/">Mobile SDK</a>, which opens up an entire universe of internet-of-things related based applications.</p>

<p>Before we (the reader and I) get flooded with an ocean of ideas, I will mention that am glad I was able to focus on just one idea and see it through its completion. I am grateful to Garmin for providing me with a platform to able to create something like this. It is very easy nowadays to get amazing insight about one’s own body. However, I think it is important not to over index on all this. You don’t even need a watch to measure your heart rate.</p>

<p>Remember not to hunch over and obsess; don’t become a “Bionicle Man”.</p>

</div></div>

                    </td>
                    </tr>
                    </table>
                    </div>
                    <div class="mobile-only">
                    <div class="target-section" id="target-section-1">
                    <!--toc_start-->

<div id="section-introduction-1" class="section"><div id="mobile-section-introduction-1" class="section">
<hr>
<h2 id="introduction-1">Introduction</h2>

<p>Hello dear reader! I am writing a new blog post as it would be amiss of me to miss adding a single post in the fading year of two thousand and twenty-three. During a small part of this busy busy year I have been preoccupied with my Garmin watch. My first watch model was a gift, and I initially thought it was a silly thing until I started using it.</p>

<p>Garmin watches allow you to track your heart rate and GPS coordinates. This allows you to understand how hard you are exerting yourself and how far you went when running, cycling, swimming, etcetera. Garmin’s data sharing ability allows you to share this information with friends in order to see what new bike routes or challenges your friends have completed. This social aspect for me was the primary benefit of the watch, represented in thoughts such as: <em>“…wait what?… so and so biked 40km across a frozen lake on a fat bike?”</em> and <em>“That’s an interesting cycling route. I will try that out tomorrow.”</em></p>

<p>You may be thinking: <em>“…ah another tracking mechanism that I don’t care for”</em> or <em>“who has got time or knowledge to view and make use of these metrics?”</em>. These are valid concerns, but the watch is what you make of it. I found the watch great for helping me become more mindful of my breath control during exercise, <a href="https://www.youtube.com/watch?v=-6PDBVRkCKc">training in specific heart rate zones</a>, and changing up my exercise routes. The watches are now so advanced that they even come with a GPS map that can assist you in some of your longer <a href="https://www.youtube.com/watch?v=wESL8G1pNIU">routes</a> - the technology is very advanced!</p>

</div></div>
<div id="section-heart-rate-variability-1" class="section"><div id="mobile-section-heart-rate-variability-1" class="section">
<hr>
<h2 id="heart-rate-variability-1">Heart Rate Variability</h2>

<p>Outside of social and exercise metrics, I wasn’t receiving too much information about my body. It wasn’t until I upgraded to the <a href="https://www.garmin.com/en-CA/p/777730">955 Solar Garmin watch</a> that I started getting some additional metrics, such as <a href="https://support.garmin.com/en-CA/?faq=WT9BmhjacO4ZpxbCc0EKn9">stress level</a>. At first I was very confused by this variable. How is it that I am sitting down, and this watch is claiming that I am stressed at a stress level of 80 out of 100… during a vacation where I do, and should feel calm?</p>

<p>The stress metric is based on the heart rate and <a href="https://medium.com/@altini_marco/the-ultimate-guide-to-heart-rate-variability-hrv-part-1-70a0a392fff4">heart rate variability (hrv)</a>. <a href="https://www.garmin.com/en-US/garmin-technology/health-science/stress-tracking/">Garmin</a> scales the metrics from 0 to 100 in order of increasing stress. Below is a sample image of Garmin watch view of my stress during a morning where I had to go for an early flight. The calm, blue, below 25 stress occured when I was sleeping on the plane.</p>

<p><img src="https://szonov.com/assets/watch_images/stress_view.jpg" alt=""></p>

<p>The stress metric was not immediately available from the watch’s resting face, and I had to press one of the side buttons to see the live data. I was so preoccupied with all of this that my friend nicknamed me the “Bionicle Man”. Half man, half robot - obsessed and hunched over my watch, looking at my metrics throughout all moments of the vacation.</p>

</div></div>
<div id="section-the-watch-app-1" class="section"><div id="mobile-section-the-watch-app-1" class="section">
<hr>
<h2 id="the-watch-app-1">The Watch App</h2>

<p>I decided to combine my old love for little programming projects with this new found curiosity in the dynamic stress metric. Fortunately, Garmin has a wonderful <a href="https://developer.garmin.com/">software development kit</a> and <a href="https://forums.garmin.com/developer/connect-iq/">detailed forums</a> that allows one to create their own watch faces and apps. I set out to create a stress monitoring watch!</p>

<p>Unfortunately, when programming the watch face, <a href="https://forums.garmin.com/developer/connect-iq/f/discussion/286382/stress-and-heart-rate-in-low-power-mode">one cannot get access to a ‘live’ stress metric</a>. Therefore, I used the next best thing for displaying live stress data, which was the live heart rate, as these two fields are correlated. I created a watch face with a graph that displayed the heart rate for the past three minutes, and that refreshed every second. I colour coded the heart rate in the graph in order to communicate to the user when their heart rate was exceeding a resting rate. Take a look at the resulting watch face:</p>

<p><img src="https://szonov.com/assets/watch_images/cropped.gif" alt=""></p>

<p>This graph allows you to look into the history of your heart rate; to see if your heart rate is accelerating or decelerating. For the gif above, I modified the code to allow for playback of live recorded data, to demonstrate how the watch face works (it’s not actually measuring the pulse of the table). For the represented data, I started in a sitting position, stood up did some jumping jacks, and at last I sat back down. My heart started at a resting rate in the 40’s/50’s and then went up to the 90’s, and then went back down to resting. The gif shows minute by minute updates. The live scroll can only last <a href="https://forums.garmin.com/outdoor-recreation/outdoor-recreation/f/fenix-7-series/291191/hi-power-mode/1405564#1405564">10 seconds at a time</a>, when the watch is ‘active’, due to a strict battery saving restriction implemented by Garmin. During the live scroll, the graph shifts pixel by pixel, with the right most data containing the latest heart rate. If you want the latest graph data at any time, then you just have to ‘activate’ your watch using the wrist gesture (demonstrated below - as the watch is activated the screen turns on and the graph starts displaying live heart data and at the end the watch goes back to ‘sleep’ mode).</p>

<p><img src="https://szonov.com/assets/watch_images/activate_watch.gif" alt=""></p>

<p>Outside of my heart rate during jumping jacks, I observed many interesting things. Most captivating to me was my heart rate in a sitting and working context; one’s heart beats per minute can be in the 40’s or the 80’s, all while doing the exact same thing. One’s heart rate can drift away very easily from a steady rest rate to an elevated rate. Get carried away with a thought and next thing you know your heart rate went from the 40’s to the 70’s over the span of a minute. My heart rate is the calmest when I am deeply focused on a topic.</p>

<p>These observations inspired the following two questions: How do I go from one heart rate to another, and how do I become more self aware of my body? I will not go into the details of the experiments that followed these questions, as this is not a health blog, but will mention that breathing techniques were very helpful. Having this new, easy access to my heart rate and its recent history, I was able to learn a lot and continue to learn much.</p>

<p>This observation process worked in a feedback loop; as you read the data that is coming to you about your body, you modify your behaviour (like breathing) or environment, to see if you can register a different response from your body (lower heart rate for example). Yes, it is likely and most definitely true: there are many papers on this topic describing how effective it is or not for tracking stress. However, at the time I was too excited to start coding on this project and decided not to get bogged down in the academic papers, and their potentially uncertain conclusions. <a href="https://www.youtube.com/watch?v=U2RpBeHJ33s">Here</a> is a video of another project dealing with this feedback mechanism.</p>

</div></div>
<div id="section-coding-it-up-1" class="section"><div id="mobile-section-coding-it-up-1" class="section">
<hr>
<h2 id="coding-it-up-1">Coding It Up</h2>

<p>Programming the watch face was not a linear process. There were many uncertainties and unknowns along the way. For some of these unknowns I was not sure if the project could be finished, while for some others it was just a matter of debugging. Just as my heart rate went up and down, so did my concern for the project’s feasibility. The milestones of uncertainty in order of thought were the following:</p>
<ul>
  <li>“Is programming a custom watch face even possible?”</li>
  <li>“How do I get my environment setup?”</li>
  <li>“How do I get a basic app going?”</li>
  <li>“How do I print some text?”</li>
  <li>“How do I add military time?”</li>
  <li>“How do I transfer the custom watch face to my watch face?”</li>
  <li>“What data structure should I use to store incoming heart rate data?”</li>
  <li>“How do I add some tests to make sure the data structure is solid?”</li>
  <li>“Can I get live stress data for every second?”</li>
  <li>“What about heart data?”</li>
  <li>“How do I deal with this ‘out of memory’ error?”</li>
  <li>“Can I get the watch to display a live graph all the time, or only ten seconds at a time?”</li>
  <li>“How do I make this graph look nice?”</li>
  <li>“How do I add custom fonts to my watch face?”</li>
  <li>“Which colours are available for my watch face and how do I assign them per increasing heart rate range?”</li>
  <li>“How do I align everything on my watch to my taste?”</li>
  <li>“What range of heart rate history should I add to my watch: 10, 5 or 3 minutes?”</li>
  <li>“How do I want to organize and clean up the code to make a public repository to share with others?”</li>
  <li>“What do I want to write in a blog post about the watch face to share with my friends?”</li>
</ul>

<p>I wrote these series of questions down for the non-technical reader (you?) to bring them along with me on this journey. They weren’t really that “serious” or cliff hanger like. For any programming project this is a common process, especially for those projects which are do-it-yourself. I am sure you encounter these thought paths in the various projects you work on. For a more “serious” project I would spend more time in the planning phase - here I was just itching to start coding right away!</p>

<p>For the technical reader, who is looking to create their own watch face, Garmin provides the ability to <a href="https://medium.com/@JoshuaTheMiller/making-a-watchface-for-garmin-devices-8c3ce28cae08">simulate your watch</a> on the computer, so the development becomes very quick. The programming is straight forward, and Github &amp; Garmin forums provide a plethora of examples to assist you in your project. The code I wrote can be found <a href="https://github.com/mannyray/StressWatchFace">here</a>, hosted on github for everyone to use and modify! In regard to the code, I was most satisfied with the the <a href="https://github.com/mannyray/StressWatchFace/blob/master/source/DataLinkedList.mc">data structure</a> used in storing the incoming heart rate. For this structure I used an array as a linked list for ease of handling fresh/stale data, with the added condition that the data entries in the array are equally spaced apart in time, and that there is logic to handle spotty/missing data. In addition, I implemented <a href="https://github.com/mannyray/StressWatchFace/blob/master/source/DataLinkedListTest.mc">tests for the data structure</a> ,to give confidence in its usability, and therefore allow for reuse of the code in other applications with live sensor data. The <a href="https://github.com/mannyray/StressWatchFace/blob/master/source/MannyrayWatchFaceView.mc#L360">graph code here</a> turned out very aesthetically pleasing. I was happy to conquer this, as one of my the concerns when coding up the watch was <em>“will it look good?”</em>.</p>

<p>There are lots of ways to customize the aesthetics of your watch face programmatically. Many other custom watch faces can be found in Garmin’s <a href="https://apps.garmin.com/en-US/">app store</a>, which has all sorts of applications like <a href="https://support.garmin.com/en-CA/?faq=mE1Jmwvzd84s9YuDqa3GB7">finding your phone</a>, <a href="https://apps.garmin.com/en-US/apps/503a3260-3a13-43f4-96d5-081930a46078">finding your car</a>, <a href="https://apps.garmin.com/en-US/apps/d5228d46-886e-49c0-a9bf-7eabd537a8d2">displaying the latest bitcoin price</a>, <a href="https://apps.garmin.com/en-US/apps/00aa0c38-6eed-4822-89b0-01b4bdab2501">marine autopilot</a> and many a styled, refined, and exquisite watch faces to match one’s taste.</p>

</div></div>
<div id="section-conclusion-1" class="section"><div id="mobile-section-conclusion-1" class="section">
<hr>
<h2 id="conclusion-1">Conclusion</h2>

<p>Perhaps some version of my watch face design was already created and lost to time amongst the thousands of other watch faces in the app store. Regardless, I viewed the exercise of creating a watch face very useful to me, as it was a foray into creating other additional Garmin apps and watch faces.</p>

<p>I am still interested in getting access to a ‘live’ stress metric for which I already have already some leading links (<a href="https://github.com/vtrifonov-esfiddle/TestHrv">1</a>, <a href="https://forums.garmin.com/developer/connect-iq/f/discussion/235708/getting-started-in-monkey-c-with-hrv">2</a>, <a href="https://forums.garmin.com/developer/connect-iq/f/discussion/233162/hrv-rr-intervals-api">3</a>). Furthermore, the watch can be connected to custom mobile apps via Garmin’s <a href="https://developer.garmin.com/connect-iq/core-topics/mobile-sdk-for-android/">Mobile SDK</a>, which opens up an entire universe of internet-of-things related based applications.</p>

<p>Before we (the reader and I) get flooded with an ocean of ideas, I will mention that am glad I was able to focus on just one idea and see it through its completion. I am grateful to Garmin for providing me with a platform to able to create something like this. It is very easy nowadays to get amazing insight about one’s own body. However, I think it is important not to over index on all this. You don’t even need a watch to measure your heart rate.</p>

<p>Remember not to hunch over and obsess; don’t become a “Bionicle Man”.</p>

</div></div>

                    </div>
                    <div id="sidebar-1" class="sidebar">
                    <h3 style="display: flex; align-items: center; justify-content: space-between;">
                    <span><i class="fa fa-list-ol"></i> Contents</span>
                    <span class="close-button" id="close-buttons-1" style="font-size: 24px;">×</span>
                    </h3>
                    <div class="mobile-scrollable">
                    <ul id="menu">
                    <li><a href="#mobile-section-introduction-1" onclick="event.preventDefault(); document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });">Introduction</a></li>
  <li><a href="#mobile-section-heart-rate-variability-1" onclick="event.preventDefault(); document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });">Heart Rate Variability</a></li>
  <li><a href="#mobile-section-the-watch-app-1" onclick="event.preventDefault(); document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });">The Watch App</a></li>
  <li><a href="#mobile-section-coding-it-up-1" onclick="event.preventDefault(); document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });">Coding It Up</a></li>
  <li><a href="#mobile-section-conclusion-1" onclick="event.preventDefault(); document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });">Conclusion</a></li>
                    </ul>
                    </div>
                    </div>
                    <button class="popup-button" id="popup-button-1"><i class="fa fa-list-ol"></i></button>
                    </div>
<!--toc_end-->
<script>
    function isMobileOnlyView() {
        return window.matchMedia("(max-width: 767px)").matches;
    }

    if (isMobileOnlyView()) {
        
        let popupButtons = [];
        let targetSections = [];
        let sidebars = [];
        let closebuttons = [];
        let sections_in_target_section = [];
        let links_in_sidebar = [];
        let i = 1;
        let popupButton;
        while ((popupButton = document.getElementById(`popup-button-${i}`)) !== null) {
            popupButtons.push(popupButton);
            const targetSection = document.getElementById(`target-section-${i}`)
            targetSections.push(targetSection);
            const sidebar = document.getElementById(`sidebar-${i}`);
            sidebars.push(sidebar);
            closebuttons.push(document.getElementById(`close-buttons-${i}`));

            const mobileSections = targetSection.querySelectorAll('[id^="mobile-section"]');
            // Convert NodeList to an array and push it to sections_in_target_section
            sections_in_target_section.push(Array.from(mobileSections));

            const links = sidebar.querySelectorAll('a');
            links_in_sidebar.push(Array.from(links));
            i++;
        }
        
        let popupButtonCount = i - 1;
        
        window.addEventListener('scroll', function() {
            for (let i = 1; i <= popupButtonCount; i++) {
                const popupButton = popupButtons[i-1];
                const targetSection = targetSections[i-1]
                const sectionPosition = targetSection.getBoundingClientRect();
                const viewportHeight = window.innerHeight;
                
                // Check if the target section is halfway through the viewport
                if (sectionPosition.top < viewportHeight / 2 && sectionPosition.bottom > viewportHeight / 2) {
                    popupButton.classList.add('show'); // Show the button
                } else {
                    popupButton.classList.remove('show'); // Hide the button
                }
                
                const sidebar = sidebars[i-1];
                // Hide sidebar on scroll (only on mobile)
                if (sidebar.classList.contains('show') && window.innerWidth <= 768) {
                    sidebar.classList.remove('show'); // Hide the sidebar
                }
                
                // Highlight active link based on scroll position
                let currentSectionId = '';
                sections_in_target_section[i-1].forEach(section => {
                    const sectionTop = section.getBoundingClientRect().top;
                    const sectionBottom = section.getBoundingClientRect().bottom;

                    // Check if the section is in view and at the top of the viewport
                    if (sectionTop <= viewportHeight / 2 && sectionBottom > viewportHeight / 2) {
                        currentSectionId = section.id;
                    }
                });
                
                 links_in_sidebar[i-1].forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${currentSectionId}`) {
                        link.classList.add('active'); // Highlight active link
                    }
                });
            }
        });
        
        for (let i = 1; i <= popupButtonCount; i++) {
            // Function to toggle sidebar visibility
            let popupButton = popupButtons[i-1];
            popupButton.addEventListener('click', function() {
                const sidebar = sidebars[i-1];
                sidebar.classList.toggle('show'); // Toggle sidebar visibility
                if (sidebar.classList.contains('show')) {
                    // Calculate the sidebar height and set its position
                    const sidebarHeight = sidebar.scrollHeight; // Use scrollHeight for accurate height
                    const windowHeight = window.innerHeight; // Get the window height
                    const topPosition = (windowHeight / 2); // - (sidebarHeight / 2); // Calculate top position
                    sidebar.style.top = `${topPosition}px`; // Set the top position
                    
                    links_in_sidebar[i-1].forEach(link => {
                       if (link.classList.contains('active')) {

                           function delay(time) {
                             return new Promise(resolve => setTimeout(resolve, time));
                           }
                           function scroll_adjust(){
                               // add the delay so that the sidebar can be loaded from zero size
                               // before getting all the various coordinates used in calculation
                               const scrollableElement = link.closest(".mobile-scrollable");
                               const scollableRect = scrollableElement.getBoundingClientRect();
                               const linkRect = link.getBoundingClientRect();
                               
                               if( ( linkRect.y + 100 ) > ( scollableRect.y + scollableRect.height ) || linkRect.y < scollableRect.y){
                                   const scrollTop = linkRect.top - scollableRect.top + scrollableElement.scrollTop - (scollableRect.height / 2) + (link.offsetHeight / 2);
                                   scrollableElement.scrollTo({ top: scrollTop, behavior: 'smooth' });
                               }
                           }
                           
                           delay(1000).then(() =>scroll_adjust() );
                       }
                    })
                }
                
                // Close sidebar when close button is clicked
                closebuttons[i-1].addEventListener('click', function() {
                    sidebar.classList.remove('show'); // Hide the sidebar
                });
                
                // Close sidebar when clicking outside of it
                document.addEventListener('click', function(event) {
                    if (sidebar.classList.contains('show') && !sidebar.contains(event.target) && !popupButton.contains(event.target)) {
                        sidebar.classList.remove('show'); // Hide the sidebar
                    }
                });
                
            });
        }
    } else {
        // for desktop
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.section');
            const links = document.querySelectorAll('#menu a');
            
            let currentSection = ''
            let current = ''
            
            // highlight the active link based on where the location of scroll
            output_string = window.scrollY + ""
            sections.forEach(section => {
                const sectionTop = section.getBoundingClientRect().top;
                const sectionBottom = section.getBoundingClientRect().bottom;
                
                output_string = output_string + "(" +sectionTop + ", " + sectionBottom + ")"
                if (sectionTop > 50 ) {
                    if(currentSection == ''){
                        currentSection = section
                    }
                    else if(currentSection.getBoundingClientRect().top > 0 && sectionTop < currentSection.getBoundingClientRect().top ){
                        currentSection = section
                    }
                    current = currentSection.getAttribute('id');
                }
                else if (sectionBottom > 50  ){
                    if(currentSection == ''){
                        currentSection = section
                    }
                    else if( sectionBottom < currentSection.getBoundingClientRect().bottom ){
                        currentSection = section
                    }
                    current = currentSection.getAttribute('id');
                }
            });
            
            links.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                    // For cases when scrollable toc is bigger than screen view
                    // and active link is outside of view
                    const scrollableElement = link.closest(".scrollable");
                    const scollableRect = scrollableElement.getBoundingClientRect();
                    const linkRect = link.getBoundingClientRect();
                    
                    if( ( linkRect.y + 100 ) > ( scollableRect.y + scollableRect.height ) || linkRect.y < scollableRect.y){
                        const scrollTop = linkRect.top - scollableRect.top + scrollableElement.scrollTop - (scollableRect.height / 2) + (link.offsetHeight / 2);
                        scrollableElement.scrollTo({ top: scrollTop, behavior: 'smooth' });
                    }
                }
            });
        });
    }
</script>
</body>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

	<div class="wrapper">

		<!--<p style="color:grey">Welcome to my site. Take a look around and don't be shy, shoot me a message!</p>-->
	</div>
  <div class="wrapper">

    <!--<h2 class="footer-heading">Stan Zonov</h2>-->

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-2">
        <ul class="contact-list">
          <!--<li>Stan Zonov</li>-->
          <!--<li>hello at szonov.com</li>-->
        </ul>
      </div>

      <div class="footer-col  footer-col-1">
	     
        <ul class="social-media-list">
	   <!--
            <p>

<span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
																	<g transform="scale(0.035)">
                  <path fill="#828282" d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z"/>
																</g>
                </svg>
              </span>

              <span class="username">hello at szonov.com</span>
	    </p>
	    </li>-->


          

          


          


        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text"></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
