<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KalmanFilter: continuous_discrete/documentation.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KalmanFilter
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">continuous_discrete/documentation.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="continuous__discrete_2documentation_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Continuous-Discrete Extended Kalman filter</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Here we will describe the continuous discrete Extended Kalman filter that is of the square root flavour. Square root does not change the math behind the algorithm, but ensures that numerical rounding errors that are natural to a computer do not prevent the computed covariance matrices maintaining their property of being positive semi definite. For a linear model, the Extended Kalman Filter is equivalent to a regular Kalman filter. Check out this [thesis](https://uwspace.uwaterloo.ca/bitstream/handle/10012/14740/Zonov_Stanislav.pdf) - chapter 3 for a detailed explanation.</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;For the continuous-discrete Kalman filter the state evolves continuously and the measurements are discrete in time. The code is in `matlab_implementation/continuous_discrete` of [https://github.com/mannyray/KalmanFilter](https://github.com/mannyray/KalmanFilter). The estimate is solved for using the RK4. The function header in `cdkef.m` is:</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;```</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;function [estimates, covariances ] = cdekf(f_func,jacobian_func,dt_between_measurements,rk4_steps, start_time, state_count, sensor_count, measurement_count,C,Q_root,R_root,P_0_root,x_0, measurements)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;```</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;For those familiar with the Kalman filter and notation are familiar with the naming of the variables. However, to be extra sure it is always best to run `help cdekf`. We will break down an example below.</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;## Example 1</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;The example is located in `matlab_implementation/continuous_discrete/examples/continuous_logistic.m`. You can `cd` into the directory and then run `continuous_logistic` or do it step by step as described below. First set the seed and include the path to `matlab_implementation/continuous_discrete`:</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;```</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;clear all;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;addpath(&#39;..&#39;);</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;%setting the seed for reproducability</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;isOctave = exist(&#39;OCTAVE_VERSION&#39;, &#39;builtin&#39;) ~= 0;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;if isOctave==true</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;   randn(&quot;seed&quot;,1);</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;else</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;   rng(1);</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;end</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;```</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;Consider the nonlinear continuous logistic growth model. The discrete example can be found in `DD-EKF` tab.</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;```</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;%define continuous logistic growth model and its jacobian</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;rate = 0.5; </div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;max_pop = 100;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;deriv_func = @(x) rate*x*(1 - x/max_pop);%logistic population model (quadratic in x)</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;if isOctave==true</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;   jacobian_func = @(x) rate - (2*x*rate)/max_pop;%manual derivative - octave might have its own function</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;else</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;   %in case you don&#39;t want to compute the jacobian manually and you have access</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;   %to Matlab then you can compute it symbolically and then extract a function from it</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;   xx = sym(&#39;x&#39;,[1,1]);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;   jacobian_func = matlabFunction(jacobian(deriv_func(xx),xx),&#39;Vars&#39;,xx);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;end</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;deriv_func = @(x,t) deriv_func(x) + 0.*t; </div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;jacobian_func = @(x,t) jacobian_func(x) + 0.*t;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;```</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;Set the time between each state evolution and the noise covariance and measurement matrices:</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;```</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;%in this model the time is only necessary</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;%for plotting an interpreting the results.</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;t_start = 0;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;t_final = 10;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;outputs = 1000;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;dt = (t_final - t_start)/outputs;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;R_c = 0.01; </div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;%discrete noise covariance. </div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;R_d = 1;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;%continuous process noise covariance</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;Q_c = 10;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;%measurement matrix</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;C = 1;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;%generate data and measurements</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;state_count = 1; </div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;sensor_count = 1;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;```</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;Set the initial estimates, covariances as well as generate data in order to run the filter:</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;```</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;%model results if there was no process noise</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;ideal_data = zeros(state_count,outputs);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;%actual data (with process noise) </div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;process_noise_data = zeros(state_count,outputs);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;%noisy measurements of actual data</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;measurements = zeros(sensor_count,outputs);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;%initial condition for ideal</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;%and real process data</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;x_0 = max_pop/2;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;P_0 = 1;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;%initial condition for ideal</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;%and real process data</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;x = x_0;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;x_noise = x_0;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;%generate the data</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;curTime = t_start;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;for ii=1:outputs</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   %Explicit Eulers</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   x = x + dt.*deriv_func(x,curTime);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;   ideal_data(:,ii) = x;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;   </div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;   %Euler-Maruyama</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;   x_noise = x_noise+dt.*deriv_func(x_noise,curTime)+sqrt(dt.*Q_c)*randn(state_count,1);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   process_noise_data(:,ii) = x_noise;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;   measurements(ii) = C*x_noise + sqrt(R_d)*randn(sensor_count,1);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   </div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;   curTime = curTime + dt;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;end</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;```</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;Filter the data:</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;```</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;%filter the noisy measurements</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;rk4_steps = 1;%internal for code - type &#39;help cdekf&#39; for more info </div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;[estimates,covariances] = cdekf(deriv_func,jacobian_func,dt,rk4_steps,t_start,...</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;   state_count,sensor_count,outputs,C,chol(Q_c)&#39;,chol(R_d)&#39;,chol(P_0)&#39;,x_0,measurements);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;```</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;Plot the results:</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;```</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;%The ideal data is not plotted and is only for reference</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;time = 0:dt:(outputs-1)*dt;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;h = figure;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;hold on;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;limit = 100;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;plot(time(1:limit),measurements(1:limit),&#39;LineWidth&#39;,2); </div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;plot(time(1:limit),process_noise_data(1:limit),&#39;LineWidth&#39;,2);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;plot(time(1:limit),estimates(1:limit),&#39;LineWidth&#39;,2);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;legend(&#39;Measurement&#39;,&#39;Real data&#39;,&#39;Estimate&#39;);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;xlabel(&#39;Time&#39;)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;ylabel(&#39;Population&#39;)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;h = figure;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;hold on;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;plot(0:dt:(outputs-1)*dt,measurements); </div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;plot(0:dt:(outputs-1)*dt,process_noise_data);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;plot(0:dt:(outputs-1)*dt,estimates(1:end-1));</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;legend(&#39;Measurement&#39;,&#39;Real data&#39;,&#39;Estimate&#39;);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;xlabel(&#39;Time&#39;)</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;ylabel(&#39;Population&#39;)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;```</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;to produce</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;&lt;!---![](../../discrete_discrete/examples/logistic1.png)---&gt;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;&lt;img src=&quot;assets/continuous_discrete/examples/logistic1.png&quot; alt=&quot;drawing2&quot; style=&quot;width:80%;max-width:600px;&quot;/&gt;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;&lt;img src=&quot;assets/continuous_discrete/examples/logistic2.png&quot; alt=&quot;drawing2&quot; style=&quot;width:80%;max-width:600px;&quot;/&gt;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;## Example 2</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;The example is located in `matlab_implementation/continuous_discrete/examples/continuous_linear.m` and has a model with two states. The script is very similar to the one in the previous example. The result produced is</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;```</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;ans =</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;   5.0489e-07   2.4509e-08</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;   2.4509e-08   4.9755e-07</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;```</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jan 28 2020 00:52:26 for KalmanFilter by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
